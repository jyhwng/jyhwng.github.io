webpackJsonp([0xf628f1416621],{386:function(n,a){n.exports={data:{markdownRemark:{html:'<h2>1. Data URI scheme (base64 encoding)</h2>\n<p>base64 로 이미지를 인코딩하여 html 에 인라인으로 넣는 방법으로, 크기가 작은 이미지를 렌더할 때 적합하다. 이미지 파일을 가져오는 http 요청을 따로 하지 않기 때문에 로딩 속도를 줄일 수 있다.</p>\n<p>인코딩된 값을 <a href="https://en.wikipedia.org/wiki/Data_URI_scheme">data URI scheme</a> (<code>data:[&#x3C;media type>][;base64],&#x3C;data></code>) 형식으로 <code>src</code> property 에 넣으면 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>data:image/png;base64,iVBORw0KGgoAAAANSU...<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>\n</code></pre>\n      </div>\n<blockquote>\n<p>이미지 크기가 클 경우에는 인코딩하여 html 에 들어가는 코드도 커지고, request 를 하지 않기 때문에 caching 도 되지 않는다는 단점이 있다.</p>\n</blockquote>\n<p>Webpack 을 사용한다면 <code>url-loader</code> 플러그인을 통해 이미지 모듈을 자동으로 인코딩/인라인 삽입할 수 있다. limit 옵션보다 작은 이미지 모듈은 인라인으로 삽입하고, 큰 모듈은 fallback 을 지정할 수 있다. fallback 을 지정하지 않으면 이미지를 파일로 취급하는 <code>file-loader</code>가 기본값이 된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>\n  test<span class="token punctuation">:</span> <span class="token regex">/\\.(png|jpe?g)$/i</span><span class="token punctuation">,</span>\n  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      loader<span class="token punctuation">:</span> <span class="token string">\'url-loader\'</span><span class="token punctuation">,</span>\n      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        limit<span class="token punctuation">:</span> <span class="token number">8192</span><span class="token punctuation">,</span>\n        fallback<span class="token punctuation">:</span> <span class="token string">\'file-loader\'</span> <span class="token comment">// default</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<hr>\n<h2>2. Preload</h2>\n<p>이미지가 로드되는동안 버벅거리는 현상을 피하려면 <code>preload</code>를 사용할 수 있다. 다른 자원들보다 우선순위를 높여서 차단 없이(non-render-blocking) 이미지를 먼저 로딩하는 방법이다.</p>\n<br>\n<h3>1. <code>&#x3C;link></code> 사용하기</h3>\n<p><code>link</code>는 현재 문서와 외부 리소스 간의 관계를 명시한다. <code>as</code> 속성값으로는 이미지 뿐만 아니라 video, css, font 등도 사용할 수 있다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n...\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo.jpg<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<ul>\n<li>\n<p>이미지를 preload 하지 않았을 때:\n<img src="https://user-images.githubusercontent.com/18133030/57197464-88adfe00-6fa2-11e9-97fb-9cfe4ccc7479.png" alt="before"></p>\n</li>\n<li>\n<p>preload 했을 때 (다른 자원보다 먼저 로드된다):\n<img src="https://user-images.githubusercontent.com/18133030/57197468-92376600-6fa2-11e9-9898-18cd1c93e37b.png" alt="after"></p>\n</li>\n</ul>\n<h3>2. <code>Image()</code> constructor 사용하기</h3>\n<p><code>new Image()</code> constructor 는 <code>HTMLImageElement</code> 객체를 생성한다. 이를 <code>window</code>가 로드될 때 실행할 수 있다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"assets/image.png"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<hr>\n<h2>3. Lazy loading with <code>IntersectionObserver</code> API</h2>\n<p>이미지가 viewport 에 들어올 때까지 기다렸다가 로드하는 것으로, <a href="https://medium.com/">medium</a> 에서 사용하는 방법이다.</p>\n<p>먼저 해상도가 낮아서 빠르게 로딩할 수 있는 placeholder 이미지를 보여주고, viewport 안에 이미지가 들어올 때 실제 이미지를 로딩한다. 기존에 이를 구현하려면 scroll 이벤트를 구독해서 <code>getBoundingClientRect()</code>함수로 직접 element 의 크기를 비교하는 등 귀찮은 작업이 많았다.</p>\n<p>하지만 <code>IntersectionObserver</code> API 를 사용하면 원하는 element 가 현재 몇 %나 보이는지 알아서 감지하고 원하는 콜백함수(이미지 로딩)를 실행할 수 있다. 이미지 lazy loading 뿐만 아니라 무한 스크롤, 광고 배너 뷰 측정 등에서도 활용된다.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder.png<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image.png<span class="token punctuation">"</span></span> <span class="token attr-name">data-srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image@2x.png 2x, image@3x.png 3x<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n</code></pre>\n      </div>\n<blockquote>\n<p>먼저, lazy loading 할 이미지에 class 등을 지정하고 src, srcset 을 data attribute 로 전달한다. 그리고 아래와 같이 <code>IntersectionObserver</code> 객체를 생성한다.</p>\n</blockquote>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> lazyImages <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"img.lazy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">let</span> lazyImageObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>entries<span class="token punctuation">,</span> observer<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">/** entries 는 변화가 감지되는 다양한 속성들이다. (e.g. isIntersecting, boundingClientRect, intersectionRect)  */</span>\n      entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> lazyImage <span class="token operator">=</span> entry<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n          lazyImage<span class="token punctuation">.</span>src <span class="token operator">=</span> lazyImage<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src<span class="token punctuation">;</span>\n          lazyImage<span class="token punctuation">.</span>srcset <span class="token operator">=</span> lazyImage<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>srcset<span class="token punctuation">;</span>\n\n          <span class="token comment">/** load를 마치면 observe를 끝낸다. */</span>\n          lazyImage<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"lazy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          lazyImageObserver<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>lazyImage<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span> threshold<span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token punctuation">}</span> <span class="token comment">/** 80%가 보이면 callback을 실행한다. */</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  lazyImages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>lazyImage <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">/** lazy 로딩이 필요한 모든 이미지에 대하여 observe 함수를 실행한다. */</span>\n    lazyImageObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>lazyImage<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p><a href="https://caniuse.com/#feat=intersectionobserver">Chrome 51 버전, Safari 12.1 버전 이상</a>부터 지원하며, 지원되지 않는 브라우저에서는 <a href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill">polyfill</a>을 사용할 수 있다.</p>\n<hr>\n<h2>4. <code>gzip</code> &#x26; CDN</h2>\n<p>이밖에도 자원을 <code>gzip</code> 으로 압축하거나 CDN 을 사용하여 최적화할 수 있다. CDN(Content Delivery Network)는 <del>마치 쿠*의 로켓직구처럼</del> 전세계 곳곳의 엣지 로케이션에서 사용자에게 가장 빠르게 전달할 수 있는 루트로 자원을 전달하는 방법이다.</p>\n<hr>\n<p>참고</p>\n<ul>\n<li><a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/">https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/</a></li>\n<li><a href="https://www.w3.org/TR/preload/">https://www.w3.org/TR/preload/</a></li>\n</ul>',frontmatter:{title:"Image Loading Optimization",date:"2019-05-05",path:"/image-optimization",tags:["image","performance","optimization","preload","intersectionobserver"],excerpt:""}}},pathContext:{}}}});
//# sourceMappingURL=path---image-optimization-600b0211a79bc6f911e5.js.map